<div class="calendar-container">
  <div class="calendar-navbar">
    <div class="calendar-navbar-item">
      <button (click)="onPrevious()">&#9664;</button>
      <span>{{ months[currentMonth] }} {{ currentYear }}</span>
      <button (click)="onNext()">&#9654;</button>
    </div>
    <div>
      <button class="today-btn" (click)="onToday()">Today</button>
    </div>
  </div>

  <div class="calendar-weekdays">
    <div *ngFor="let day of ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']">
      {{ day }}
    </div>
  </div>

  <div class="calendar-days">
    <div
      class="calendar-day"
      [ngClass]="{ 'other-month': !day.currentMonth }"
      *ngFor="let day of days"
    >
      <div class="date-label">
        <span *ngIf="day.date.getDate() === 1">
          {{ months[day.date.getMonth()].slice(0, 3) }}
        </span>
        <span [ngClass]="{ today: isToday(day.date) }">{{
          day.date.getDate()
        }}</span>
      </div>

      <ng-container *ngIf="getSlotsForDate(day.date) as slots">
        <div class="event-rows">
          <ng-container *ngFor="let ev of slots; let i = index">
            <div
              *ngIf="i < visibleRows"
              class="event-bar"
              [ngClass]="{
                'event-pending': ev?.status === 'pending',
                'event-ongoing': ev?.status === 'ongoing',
                'event-complete': ev?.status === 'complete',
                'empty-slot': !ev,
                'start-event': isStart(day.date, i),
                'end-event': isEnd(day.date, i)
              }"
            >
              <span *ngIf="ev && isStart(day.date, i)">
                {{ ev.title }}
              </span>
            </div>
          </ng-container>

          <div
            class="more-btn"
            *ngIf="getEventCount(day.date) > visibleRows"
            (click)="openDayModal(day.date)"
          >
            {{ getEventCount(day.date) - visibleRows }} More
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<app-modal-event
  [date]="modalDate"
  [events]="modalDate ? getEventsForModal(modalDate) : []"
  (close)="closeModal()"
></app-modal-event>
